-- [ Dependencies ] --
local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- [ UI Setup ] --
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "MiningIncXrayGUI"
screenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local statusLabel = Instance.new("TextLabel")
statusLabel.Name = "StatusLabel"
statusLabel.Size = UDim2.new(0, 350, 0, 22)
statusLabel.Position = UDim2.new(0.5, -175, 0, 10)
statusLabel.BackgroundTransparency = 1
statusLabel.Text = "Idle."
statusLabel.TextColor3 = Color3.fromRGB(255, 215, 0)
statusLabel.TextStrokeColor3 = Color3.fromRGB(153, 117, 0)
statusLabel.TextStrokeTransparency = 0
statusLabel.Font = Enum.Font.SourceSansBold
statusLabel.TextSize = 16
statusLabel.Parent = screenGui

-- [ Konfigurasi Ore + Harga ] --
local orePrices = {
    ["Iron"] = 8,
    ["Nickel"] = 9,
    ["Bronze"] = 10,
    ["Aluminium"] = 20,
    ["Copper"] = 20,
    ["Silver"] = 25,
    ["Coal"] = 35,
    ["Titanium"] = 70,
    ["Ruby"] = 85,
    ["Gold"] = 100,
    ["Quartz"] = 102,
    ["Cobalt"] = 120,
    ["Limestone"] = 140,
    ["Lithium"] = 200,
    ["Iridium"] = 275,
    ["Diamond"] = 300,
    ["Sapphire"] = 325,
    ["Obsidian"] = 350,
    ["Jade"] = 400,
    ["Mercury"] = 450,
    ["Emerald"] = 600,
    ["Uranium"] = 1000,
    ["Plutonium"] = 1100
}

local mineralsFolder = workspace:FindFirstChild("Minerals")
local cratesFolder = workspace:FindFirstChild("Crates")

local ESP_ENABLED = false
local ORE_TARGET_POS = Vector3.new(-256, 12058, -112)
local CRATE_TARGET_POS = Vector3.new(-519.422, 12055.689, -916.140) -- +5 Y

-- [ Util ] --
local function updateStatusText(txt)
    statusLabel.Text = txt
end

local function drawOreEsp(ore)
    local adorneePart = ore:IsA("BasePart") and ore
        or (ore:IsA("Model") and (ore.PrimaryPart or ore:FindFirstChildWhichIsA("BasePart")))
        or ore:FindFirstChildWhichIsA("BasePart")

    if not adorneePart then return end

    local billboardGui = Instance.new("BillboardGui")
    billboardGui.Name = "OreEsp"
    billboardGui.Adornee = adorneePart
    billboardGui.AlwaysOnTop = true
    billboardGui.Size = UDim2.new(0, 140, 0, 30)
    billboardGui.StudsOffset = Vector3.new(0, 2, 0)
    billboardGui.Parent = screenGui

    local esp = Instance.new("TextLabel")
    esp.Size = UDim2.new(1, 0, 1, 0)
    esp.BackgroundTransparency = 1

    local price = orePrices[ore.Name] or "?"
    esp.Text = ore.Name .. " - " .. tostring(price) .. "$"
    esp.TextColor3 = Color3.fromRGB(255, 215, 0)
    esp.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    esp.TextStrokeTransparency = 0
    esp.Font = Enum.Font.SourceSansBold
    esp.TextScaled = true
    esp.Parent = billboardGui
end

local function deleteOreEsp()
    for _, child in ipairs(screenGui:GetChildren()) do
        if child.Name == "OreEsp" then
            child:Destroy()
        end
    end
end

-- [ Teleport Semua Ore Target ] --
local function teleportAllOres()
    if not mineralsFolder then return end
    local moved = 0

    for _, obj in ipairs(mineralsFolder:GetChildren()) do
        if orePrices[obj.Name] then
            if obj:IsA("Model") then
                if obj.PrimaryPart then
                    obj:SetPrimaryPartCFrame(CFrame.new(ORE_TARGET_POS))
                else
                    obj:MoveTo(ORE_TARGET_POS)
                end
            elseif obj:IsA("BasePart") then
                obj.CFrame = CFrame.new(ORE_TARGET_POS)
            else
                local p = obj:FindFirstChildWhichIsA("BasePart")
                if p then p.CFrame = CFrame.new(ORE_TARGET_POS) end
            end
            moved += 1
        end
    end
    updateStatusText("Teleported " .. moved .. " ores to target.")
end

-- [ Teleport Semua Crates ] --
local function teleportAllCrates()
    if not cratesFolder then return end
    local moved = 0

    for _, crate in ipairs(cratesFolder:GetChildren()) do
        if crate:IsA("Model") then
            if crate.PrimaryPart then
                crate:SetPrimaryPartCFrame(CFrame.new(CRATE_TARGET_POS))
            else
                crate:MoveTo(CRATE_TARGET_POS)
            end
        elseif crate:IsA("BasePart") then
            crate.CFrame = CFrame.new(CRATE_TARGET_POS)
        end
        moved += 1
    end
    updateStatusText("Teleported " .. moved .. " crates.")
end

-- [ Scan ESP ] --
local function scanEsp()
    deleteOreEsp()
    if not mineralsFolder then return end
    local count = 0
    for _, obj in ipairs(mineralsFolder:GetChildren()) do
        if orePrices[obj.Name] then
            drawOreEsp(obj)
            count += 1
        end
    end
    updateStatusText("ESP ON: " .. count .. " ores.")
end

-- [ Teleport Player ] --
local function teleportPlayer(pos)
    local char = LocalPlayer.Character
    if not char then return end
    local root = char:FindFirstChild("HumanoidRootPart")
    if root then
        root.CFrame = CFrame.new(pos)
    end
end

-- [ Input Handler ] --
UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end

    if input.KeyCode == Enum.KeyCode.M then
        ESP_ENABLED = not ESP_ENABLED
        if ESP_ENABLED then
            scanEsp()
        else
            deleteOreEsp()
            updateStatusText("ESP OFF")
        end
    end

    if input.KeyCode == Enum.KeyCode.K then
        teleportAllOres()
    end

    if input.KeyCode == Enum.KeyCode.N then
        teleportAllCrates()
    end

    -- Teleport player shortcuts
    local tpPoints = {
        [Enum.KeyCode.Five] = Vector3.new(-144, 12060, -284),
        [Enum.KeyCode.Six]  = Vector3.new(-219, 12055, 133),
        [Enum.KeyCode.Seven]= Vector3.new(-189, 12055, 172),
        [Enum.KeyCode.Eight]= Vector3.new(232, 12066, 31),
        [Enum.KeyCode.Nine] = Vector3.new(-675, 12055, -861),
    }
    local pos = tpPoints[input.KeyCode]
    if pos then teleportPlayer(pos) end
end)

-- [ Auto Refresh ESP ] --
task.spawn(function()
    while true do
        task.wait(6)
        if ESP_ENABLED then
            scanEsp()
        end
    end
end)